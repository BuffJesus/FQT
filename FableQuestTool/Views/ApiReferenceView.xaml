<UserControl x:Class="FableQuestTool.Views.ApiReferenceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:FableQuestTool.ViewModels"
             xmlns:local="clr-namespace:FableQuestTool.Views"
             xmlns:converters="clr-namespace:FableQuestTool.Converters"
             mc:Ignorable="d">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:InvertedNullToVisibilityConverter x:Key="InvertedNullToVisibilityConverter" />
    </UserControl.Resources>
    <UserControl.DataContext>
        <vm:ApiReferenceViewModel />
    </UserControl.DataContext>
    <Grid Background="{DynamicResource BackgroundPrimary}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240" MinWidth="200" MaxWidth="320" />
            <ColumnDefinition Width="*" MinWidth="360" />
            <ColumnDefinition Width="400" MinWidth="320" MaxWidth="520" />
        </Grid.ColumnDefinitions>
        
        <!-- Left Panel: Categories and Search -->
        <Border Grid.Column="0" Background="{DynamicResource PanelBackground}">
            <StackPanel Margin="12">
                <TextBlock Text="API Reference" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,12" />
                
                <!-- Search Box -->
                <TextBlock Text="Search" FontSize="11" Opacity="0.7" Margin="0,0,0,4" />
                <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                         Height="28"
                         Padding="6,4"
                         Margin="0,0,0,12" />
                
                <!-- Categories -->
                <TextBlock Text="Categories" FontSize="11" Opacity="0.7" Margin="0,0,0,4" />
                <ListBox ItemsSource="{Binding Categories}"
                         SelectedItem="{Binding SelectedCategory}"
                         BorderThickness="0"
                         Background="Transparent">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" Padding="4,6" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
        </Border>
        
        <!-- Middle Panel: Function List -->
        <Border Grid.Column="1" Background="{DynamicResource SurfaceBackground}" Margin="8">
            <DockPanel>
                <Border DockPanel.Dock="Top" Background="{DynamicResource PanelBackground}" Padding="8" Margin="12,12,12,8">
                    <TextBlock Text="{Binding FilteredFunctions.Count, StringFormat='Functions ({0})'}"
                               FontWeight="SemiBold" />
                </Border>
                <TextBlock DockPanel.Dock="Top"
                           Text="{Binding ApiStatus}"
                           TextWrapping="Wrap"
                           Margin="12,0,12,8"
                           Opacity="0.7">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding HasApiData}" Value="False">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <ListBox ItemsSource="{Binding FilteredFunctions}"
                         SelectedItem="{Binding SelectedFunction}"
                         BorderThickness="0"
                         Background="Transparent"
                         Visibility="{Binding HasApiData, Converter={StaticResource BoolToVisibilityConverter}}"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="8,6" Margin="4,2">
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}" 
                                             FontWeight="SemiBold"
                                             TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding Description}" 
                                             FontSize="10"
                                             Opacity="0.7"
                                             TextWrapping="Wrap"
                                             Margin="0,2,0,0" />
                                    <TextBlock Text="{Binding ReturnType, StringFormat='Returns: {0}'}"
                                             FontSize="9"
                                             Opacity="0.5"
                                             Margin="0,2,0,0" />
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>
        
        <!-- Right Panel: Function Details -->
        <Border Grid.Column="2" Background="{DynamicResource PanelBackground}">
            <ScrollViewer>
                <StackPanel Margin="12">
                    <Border Background="{DynamicResource SurfaceBackground}" Padding="8" Margin="0,0,0,12">
                        <TextBlock Text="Function Details" FontWeight="SemiBold" />
                    </Border>
                    
                    <StackPanel Visibility="{Binding SelectedFunction, Converter={StaticResource NullToVisibilityConverter}}">
                        <!-- Function Name -->
                        <TextBlock Text="{Binding SelectedFunction.Name}"
                                 FontWeight="SemiBold"
                                 FontSize="16"
                                 Margin="0,0,0,8" />
                        
                        <!-- Category Badge -->
                        <Border Background="{DynamicResource BorderBrush}"
                              CornerRadius="3"
                              Padding="6,3"
                              HorizontalAlignment="Left"
                              Margin="0,0,0,12">
                            <TextBlock Text="{Binding SelectedFunction.Category}"
                                     FontSize="10"
                                     FontWeight="SemiBold" />
                        </Border>
                        
                        <!-- Description -->
                        <TextBlock Text="Description" FontSize="11" Opacity="0.7" Margin="0,0,0,4" />
                        <TextBlock Text="{Binding SelectedFunction.Description}"
                                 TextWrapping="Wrap"
                                 Margin="0,0,0,12" />
                        
                        <!-- Return Type -->
                        <TextBlock Text="Return Type" FontSize="11" Opacity="0.7" Margin="0,0,0,4" />
                        <TextBlock Text="{Binding SelectedFunction.ReturnType}"
                                 FontFamily="Consolas"
                                 Margin="0,0,0,12" />
                        
                        <!-- Parameters -->
                        <TextBlock Text="Parameters" FontSize="11" Opacity="0.7" Margin="0,0,0,4" />
                        <ItemsControl ItemsSource="{Binding SelectedFunction.Parameters}"
                                    Margin="0,0,0,12">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{DynamicResource SurfaceBackground}"
                                          Padding="6,4"
                                          Margin="0,2"
                                          CornerRadius="3">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock FontFamily="Consolas" FontSize="11">
                                                <Run Text="{Binding Type}" />
                                                <Run Text=" " />
                                                <Run Text="{Binding Name}" FontWeight="SemiBold" />
                                            </TextBlock>
                                            <TextBlock Text=" [optional]"
                                                     Foreground="Orange"
                                                     FontFamily="Consolas"
                                                     FontSize="11"
                                                     Margin="4,0,0,0"
                                                     Visibility="{Binding IsOptional, Converter={StaticResource BoolToVisibilityConverter}}" />
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- Example -->
                        <TextBlock Text="Example Usage" FontSize="11" Opacity="0.7" Margin="0,0,0,4" />
                        <Border Background="{DynamicResource SurfaceBackground}"
                              Padding="8"
                              CornerRadius="3"
                              Margin="0,0,0,12">
                            <TextBlock Text="{Binding SelectedFunction.Example}"
                                     FontFamily="Consolas"
                                     TextWrapping="Wrap" />
                        </Border>
                        
                        <!-- Action Buttons -->
                        <StackPanel Orientation="Horizontal">
                            <Button Content="Copy Example" 
                                  Width="120"
                                  Command="{Binding CopyExampleCommand}"
                                  Margin="0,0,8,0" />
                            <Button Content="Copy Signature" 
                                  Width="120"
                                  Command="{Binding CopySignatureCommand}" />
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- No Selection Message -->
                    <TextBlock Text="Select a function from the list to view details"
                             Opacity="0.5"
                             TextWrapping="Wrap"
                             Visibility="{Binding SelectedFunction, Converter={StaticResource InvertedNullToVisibilityConverter}}" />
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
