<UserControl x:Class="FableQuestTool.Views.TemplatesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:FableQuestTool.ViewModels"
             xmlns:local="clr-namespace:FableQuestTool.Views"
             xmlns:converters="clr-namespace:FableQuestTool.Converters"
             mc:Ignorable="d">
    <UserControl.Resources>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:InvertedNullToVisibilityConverter x:Key="InvertedNullToVisibilityConverter" />
    </UserControl.Resources>
    <UserControl.DataContext>
        <vm:TemplatesViewModel />
    </UserControl.DataContext>
    <Grid Background="{DynamicResource BackgroundPrimary}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240" MinWidth="200" MaxWidth="320" />
            <ColumnDefinition Width="*" MinWidth="360" />
            <ColumnDefinition Width="400" MinWidth="320" MaxWidth="520" />
        </Grid.ColumnDefinitions>
        
        <!-- Left Panel: Categories -->
        <Border Grid.Column="0" Background="{DynamicResource PanelBackground}">
            <StackPanel Margin="12">
                <TextBlock Text="Quest Templates" Style="{StaticResource PanelHeaderText}" Margin="0,0,0,12" />
                
                <TextBlock Text="Categories" Style="{StaticResource SectionHeaderText}" Margin="0,0,0,4" />
                <ListBox ItemsSource="{Binding Categories}"
                         SelectedItem="{Binding SelectedCategory}"
                         BorderThickness="0"
                         Background="Transparent">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}" Padding="4,6" />
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
        </Border>
        <GridSplitter Grid.Column="0"
                      HorizontalAlignment="Right"
                      VerticalAlignment="Stretch"
                      Width="6"
                      Background="{DynamicResource BorderBrush}" />
        
        <!-- Middle Panel: Template List -->
        <Border Grid.Column="1" Background="{DynamicResource SurfaceBackground}" Margin="8">
            <DockPanel>
                <Border DockPanel.Dock="Top" Background="{DynamicResource PanelBackground}" Padding="8" Margin="12,12,12,8">
                    <TextBlock Text="Available Templates" Style="{StaticResource PanelHeaderText}" />
                </Border>
                <ListBox ItemsSource="{Binding FilteredTemplates}"
                         SelectedItem="{Binding SelectedTemplate}"
                         BorderThickness="0"
                         Background="Transparent"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="12,8" Margin="4,2" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}" CornerRadius="4">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    
                                    <TextBlock Grid.Row="0"
                                             Text="{Binding Name}"
                                             Style="{StaticResource PanelHeaderText}"
                                             FontSize="14"
                                             TextWrapping="Wrap" />
                                    
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4,0,4">
                                        <Border Background="{DynamicResource BorderBrush}"
                                              Padding="4,2"
                                              CornerRadius="2"
                                              Margin="0,0,4,0">
                                            <TextBlock Text="{Binding Category}"
                                                     Style="{StaticResource SectionHeaderText}"
                                                     FontSize="10" />
                                        </Border>
                                        <Border Background="{DynamicResource BorderBrush}"
                                              Padding="4,2"
                                              CornerRadius="2">
                                            <TextBlock Text="{Binding Difficulty}"
                                                     Style="{StaticResource SectionHeaderText}"
                                                     FontSize="10" />
                                        </Border>
                                    </StackPanel>
                                    
                                    <TextBlock Grid.Row="2"
                                             Text="{Binding Description}"
                                             TextWrapping="Wrap"
                                             Style="{StaticResource MutedText}"
                                             FontSize="11" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>
        <GridSplitter Grid.Column="1"
                      HorizontalAlignment="Right"
                      VerticalAlignment="Stretch"
                      Width="6"
                      Background="{DynamicResource BorderBrush}" />
        
        <!-- Right Panel: Template Details -->
        <Border Grid.Column="2" Background="{DynamicResource PanelBackground}">
            <ScrollViewer>
                <StackPanel Margin="12">
                    <Border Background="{DynamicResource SurfaceBackground}" Padding="8" Margin="0,0,0,12">
                        <TextBlock Text="Template Details" Style="{StaticResource PanelHeaderText}" />
                    </Border>
                    
                    <StackPanel Visibility="{Binding SelectedTemplate, Converter={StaticResource NullToVisibilityConverter}}">
                        <!-- Template Name -->
                        <TextBlock Text="{Binding SelectedTemplate.Name}"
                                 Style="{StaticResource PanelHeaderText}"
                                 FontSize="16"
                                 TextWrapping="Wrap"
                                 Margin="0,0,0,8" />
                        
                        <!-- Category and Difficulty -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                            <Border Background="{DynamicResource SurfaceBackground}"
                                  Padding="6,3"
                                  CornerRadius="3"
                                  Margin="0,0,6,0">
                                <TextBlock Text="{Binding SelectedTemplate.Category}"
                                         Style="{StaticResource SectionHeaderText}"
                                         FontSize="11" />
                            </Border>
                            <Border Background="{DynamicResource SurfaceBackground}"
                                  Padding="6,3"
                                  CornerRadius="3">
                                <TextBlock Text="{Binding SelectedTemplate.Difficulty}"
                                         Style="{StaticResource SectionHeaderText}"
                                         FontSize="11" />
                            </Border>
                        </StackPanel>
                        
                        <!-- Description -->
                        <TextBlock Text="Description" Style="{StaticResource SectionHeaderText}" Margin="0,0,0,4" />
                        <TextBlock Text="{Binding SelectedTemplate.Description}"
                                 TextWrapping="Wrap"
                                 Margin="0,0,0,12" />
                        
                        <!-- Template Info -->
                        <TextBlock Text="What's Included" Style="{StaticResource SectionHeaderText}" Margin="0,0,0,4" />
                        <Border Background="{DynamicResource SurfaceBackground}"
                              Padding="8"
                              CornerRadius="3"
                              Margin="0,0,0,12">
                            <StackPanel>
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,4">
                                    <Run Text="- Quest Name: " FontWeight="SemiBold" />
                                    <Run Text="{Binding SelectedTemplate.Template.Name}" />
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,4">
                                    <Run Text="- Display Name: " FontWeight="SemiBold" />
                                    <Run Text="{Binding SelectedTemplate.Template.DisplayName}" />
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,4">
                                    <Run Text="- Regions: " FontWeight="SemiBold" />
                                    <Run Text="{Binding SelectedTemplate.Template.Regions.Count, Mode=OneWay}" />
                                    <Run Text=" region(s)" />
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,4">
                                    <Run Text="- Entities: " FontWeight="SemiBold" />
                                    <Run Text="{Binding SelectedTemplate.Template.Entities.Count, Mode=OneWay}" />
                                    <Run Text=" entity(-ies)" />
                                </TextBlock>
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,4">
                                    <Run Text="- Rewards: Gold, Renown, Experience" />
                                </TextBlock>
                            </StackPanel>
                        </Border>
                        
                        <!-- Use Template Button -->
                        <Button Content="Use This Template"
                              Height="36"
                              FontWeight="SemiBold"
                              Command="{Binding UseTemplateCommand}" />
                    </StackPanel>
                    
                    <!-- No Selection Message -->
                    <TextBlock Text="Select a template from the list to view details and create a new quest from it"
                             Style="{StaticResource MutedText}"
                             TextWrapping="Wrap"
                             Visibility="{Binding SelectedTemplate, Converter={StaticResource InvertedNullToVisibilityConverter}}" />
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
